<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libnfc: nfc.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libnfc
   &#160;<span id="projectnumber">1.7.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_ddd49a329a90e651ff9e16d6bb2e9f64.html">libnfc</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">nfc.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="nfc_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*-</span>
<a name="l00002"></a>00002 <span class="comment"> * Free/Libre Near Field Communication (NFC) library</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Libnfc historical contributors:</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (C) 2009      Roel Verdult</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (C) 2009-2013 Romuald Conty</span>
<a name="l00007"></a>00007 <span class="comment"> * Copyright (C) 2010-2012 Romain Tarti√®re</span>
<a name="l00008"></a>00008 <span class="comment"> * Copyright (C) 2010-2013 Philippe Teuwen</span>
<a name="l00009"></a>00009 <span class="comment"> * Copyright (C) 2012-2013 Ludovic Rousseau</span>
<a name="l00010"></a>00010 <span class="comment"> * See AUTHORS file for a more comprehensive list of contributors.</span>
<a name="l00011"></a>00011 <span class="comment"> * Additional contributors of this file:</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * This program is free software: you can redistribute it and/or modify it</span>
<a name="l00014"></a>00014 <span class="comment"> * under the terms of the GNU Lesser General Public License as published by the</span>
<a name="l00015"></a>00015 <span class="comment"> * Free Software Foundation, either version 3 of the License, or (at your</span>
<a name="l00016"></a>00016 <span class="comment"> * option) any later version.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00019"></a>00019 <span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<a name="l00020"></a>00020 <span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<a name="l00021"></a>00021 <span class="comment"> * more details.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00024"></a>00024 <span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span>
<a name="l00025"></a>00025 <span class="comment"> */</span>
<a name="l00026"></a>00026 
<a name="l00073"></a>00073 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;config.h&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#endif // HAVE_CONFIG_H</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#include &lt;<a class="code" href="nfc_8h.html" title="libnfc interface">nfc/nfc.h</a>&gt;</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="preprocessor">#include &quot;<a class="code" href="nfc-internal_8h.html" title="Internal defines and macros.">nfc-internal.h</a>&quot;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &quot;target-subr.h&quot;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &quot;drivers.h&quot;</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="preprocessor">#if defined (DRIVER_ACR122_PCSC_ENABLED)</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/acr122_pcsc.h&quot;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ACR122_PCSC_ENABLED */</span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="preprocessor">#if defined (DRIVER_ACR122_USB_ENABLED)</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/acr122_usb.h&quot;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ACR122_USB_ENABLED */</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="preprocessor">#if defined (DRIVER_ACR122S_ENABLED)</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/acr122s.h&quot;</span>
<a name="l00099"></a>00099 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ACR122S_ENABLED */</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#if defined (DRIVER_PN53X_USB_ENABLED)</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/pn53x_usb.h&quot;</span>
<a name="l00103"></a>00103 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN53X_USB_ENABLED */</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="preprocessor">#if defined (DRIVER_ARYGON_ENABLED)</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/arygon.h&quot;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ARYGON_ENABLED */</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="preprocessor">#if defined (DRIVER_PN532_UART_ENABLED)</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/pn532_uart.h&quot;</span>
<a name="l00111"></a>00111 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN532_UART_ENABLED */</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="preprocessor">#if defined (DRIVER_PN532_SPI_ENABLED)</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/pn532_spi.h&quot;</span>
<a name="l00115"></a>00115 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN532_SPI_ENABLED */</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="preprocessor">#if defined (DRIVER_PN532_I2C_ENABLED)</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;drivers/pn532_i2c.h&quot;</span>
<a name="l00119"></a>00119 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN532_I2C_ENABLED */</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="preprocessor">#define LOG_CATEGORY &quot;libnfc.general&quot;</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#define LOG_GROUP    NFC_LOG_GROUP_GENERAL</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00125"></a>00125 <span class="keyword">struct </span>nfc_driver_list {
<a name="l00126"></a>00126   <span class="keyword">const</span> <span class="keyword">struct </span>nfc_driver_list *next;
<a name="l00127"></a>00127   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="nfc-types_8h.html#a248817f16c689686290df9c35fa3dd78">nfc_driver</a> *driver;
<a name="l00128"></a>00128 };
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="keyword">const</span> <span class="keyword">struct </span>nfc_driver_list *nfc_drivers = NULL;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00133"></a>00133 nfc_drivers_init(<span class="keywordtype">void</span>)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135 <span class="preprocessor">#if defined (DRIVER_PN53X_USB_ENABLED)</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;pn53x_usb_driver);
<a name="l00137"></a>00137 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN53X_USB_ENABLED */</span>
<a name="l00138"></a>00138 <span class="preprocessor">#if defined (DRIVER_ACR122_PCSC_ENABLED)</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;acr122_pcsc_driver);
<a name="l00140"></a>00140 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ACR122_PCSC_ENABLED */</span>
<a name="l00141"></a>00141 <span class="preprocessor">#if defined (DRIVER_ACR122_USB_ENABLED)</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;acr122_usb_driver);
<a name="l00143"></a>00143 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ACR122_USB_ENABLED */</span>
<a name="l00144"></a>00144 <span class="preprocessor">#if defined (DRIVER_ACR122S_ENABLED)</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;acr122s_driver);
<a name="l00146"></a>00146 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ACR122S_ENABLED */</span>
<a name="l00147"></a>00147 <span class="preprocessor">#if defined (DRIVER_PN532_UART_ENABLED)</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;pn532_uart_driver);
<a name="l00149"></a>00149 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN532_UART_ENABLED */</span>
<a name="l00150"></a>00150 <span class="preprocessor">#if defined (DRIVER_PN532_SPI_ENABLED)</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;pn532_spi_driver);
<a name="l00152"></a>00152 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN532_SPI_ENABLED */</span>
<a name="l00153"></a>00153 <span class="preprocessor">#if defined (DRIVER_PN532_I2C_ENABLED)</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;pn532_i2c_driver);
<a name="l00155"></a>00155 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_PN532_I2C_ENABLED */</span>
<a name="l00156"></a>00156 <span class="preprocessor">#if defined (DRIVER_ARYGON_ENABLED)</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>  <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(&amp;arygon_driver);
<a name="l00158"></a>00158 <span class="preprocessor">#endif </span><span class="comment">/* DRIVER_ARYGON_ENABLED */</span>
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00169"></a>00169 <span class="keywordtype">int</span>
<a name="l00170"></a><a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82">00170</a> <a class="code" href="group__lib.html#ga5839bbf10f761302e1f2c1ad02c72e82" title="Register an NFC device driver with libnfc. This function registers a driver with libnfc, the caller is responsible of managing the lifetime of the driver and make sure that any resources associated with the driver are available after registration.">nfc_register_driver</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="nfc-types_8h.html#a248817f16c689686290df9c35fa3dd78">nfc_driver</a> *ndr)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172   <span class="keywordflow">if</span> (!ndr)
<a name="l00173"></a>00173     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ga45996965dbf5bd4688cb026486b39bbe">NFC_EINVARG</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keyword">struct </span>nfc_driver_list *pndl = (<span class="keyword">struct </span>nfc_driver_list *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> nfc_driver_list));
<a name="l00176"></a>00176   <span class="keywordflow">if</span> (!pndl)
<a name="l00177"></a>00177     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ga7148e637813471ddd2156bae393ad5bd">NFC_ESOFT</a>;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   pndl-&gt;driver = ndr;
<a name="l00180"></a>00180   pndl-&gt;next = nfc_drivers;
<a name="l00181"></a>00181   nfc_drivers = pndl;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">return</span> <a class="code" href="group__error.html#gaf4e6b9599444bd531ceb8cc0541b22a6">NFC_SUCCESS</a>;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00191"></a>00191 <span class="keywordtype">void</span>
<a name="l00192"></a><a class="code" href="group__lib.html#gae494d97ba0cc10efda9065a07c8900a8">00192</a> <a class="code" href="group__lib.html#gae494d97ba0cc10efda9065a07c8900a8" title="Initialize libnfc. This function must be called before calling any other libnfc function.">nfc_init</a>(<a class="code" href="structnfc__context.html" title="NFC library context Struct which contains internal options, references, pointers, etc...">nfc_context</a> **context)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194   *context = nfc_context_new();
<a name="l00195"></a>00195   <span class="keywordflow">if</span> (!*context) {
<a name="l00196"></a>00196     perror(<span class="stringliteral">&quot;malloc&quot;</span>);
<a name="l00197"></a>00197     <span class="keywordflow">return</span>;
<a name="l00198"></a>00198   }
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (!nfc_drivers)
<a name="l00200"></a>00200     nfc_drivers_init();
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00208"></a>00208 <span class="keywordtype">void</span>
<a name="l00209"></a><a class="code" href="group__lib.html#gabd34e0cc381699d6aec73bf993105400">00209</a> <a class="code" href="group__lib.html#gabd34e0cc381699d6aec73bf993105400" title="Deinitialize libnfc. Should be called after closing all open devices and before your application term...">nfc_exit</a>(<a class="code" href="structnfc__context.html" title="NFC library context Struct which contains internal options, references, pointers, etc...">nfc_context</a> *context)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   <span class="keywordflow">while</span> (nfc_drivers) {
<a name="l00212"></a>00212     <span class="keyword">struct </span>nfc_driver_list *pndl = (<span class="keyword">struct </span>nfc_driver_list *) nfc_drivers;
<a name="l00213"></a>00213     nfc_drivers = pndl-&gt;next;
<a name="l00214"></a>00214     free(pndl);
<a name="l00215"></a>00215   }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   nfc_context_free(context);
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00237"></a>00237 <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *
<a name="l00238"></a><a class="code" href="group__dev.html#ga9a0b9811c0e7f93e7474db82a1fb4501">00238</a> <a class="code" href="group__dev.html#ga9a0b9811c0e7f93e7474db82a1fb4501" title="Open a NFC device.">nfc_open</a>(<a class="code" href="structnfc__context.html" title="NFC library context Struct which contains internal options, references, pointers, etc...">nfc_context</a> *context, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a4661cdd5e004127850781d7d78c72cc7">nfc_connstring</a> connstring)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd = NULL;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <a class="code" href="nfc-types_8h.html#a4661cdd5e004127850781d7d78c72cc7">nfc_connstring</a> ncs;
<a name="l00243"></a>00243   <span class="keywordflow">if</span> (connstring == NULL) {
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (!<a class="code" href="group__dev.html#gafa660af0c0729cd5378fe895876b42c5" title="Scan for discoverable supported devices (ie. only available for some drivers)">nfc_list_devices</a>(context, &amp;ncs, 1)) {
<a name="l00245"></a>00245       <span class="keywordflow">return</span> NULL;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247   } <span class="keywordflow">else</span> {
<a name="l00248"></a>00248     strncpy(ncs, connstring, <span class="keyword">sizeof</span>(<a class="code" href="nfc-types_8h.html#a4661cdd5e004127850781d7d78c72cc7">nfc_connstring</a>));
<a name="l00249"></a>00249     ncs[<span class="keyword">sizeof</span>(<a class="code" href="nfc-types_8h.html#a4661cdd5e004127850781d7d78c72cc7">nfc_connstring</a>) - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00250"></a>00250   }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="comment">// Search through the device list for an available device</span>
<a name="l00253"></a>00253   <span class="keyword">const</span> <span class="keyword">struct </span>nfc_driver_list *pndl = nfc_drivers;
<a name="l00254"></a>00254   <span class="keywordflow">while</span> (pndl) {
<a name="l00255"></a>00255     <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="nfc-types_8h.html#a248817f16c689686290df9c35fa3dd78">nfc_driver</a> *ndr = pndl-&gt;driver;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">// Specific device is requested: using device description</span>
<a name="l00258"></a>00258     <span class="keywordflow">if</span> (0 != strncmp(ndr-&gt;name, ncs, strlen(ndr-&gt;name))) {
<a name="l00259"></a>00259       <span class="comment">// Check if connstring driver is usb -&gt; accept any driver *_usb</span>
<a name="l00260"></a>00260       <span class="keywordflow">if</span> ((0 != strncmp(<span class="stringliteral">&quot;usb&quot;</span>, ncs, strlen(<span class="stringliteral">&quot;usb&quot;</span>))) || 0 != strncmp(<span class="stringliteral">&quot;_usb&quot;</span>, ndr-&gt;name + (strlen(ndr-&gt;name) - 4), 4)) {
<a name="l00261"></a>00261         pndl = pndl-&gt;next;
<a name="l00262"></a>00262         <span class="keywordflow">continue</span>;
<a name="l00263"></a>00263       }
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     pnd = ndr-&gt;open(context, ncs);
<a name="l00267"></a>00267     <span class="comment">// Test if the opening was successful</span>
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (pnd == NULL) {
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (0 == strncmp(<span class="stringliteral">&quot;usb&quot;</span>, ncs, strlen(<span class="stringliteral">&quot;usb&quot;</span>))) {
<a name="l00270"></a>00270         <span class="comment">// We&#39;ve to test the other usb drivers before giving up</span>
<a name="l00271"></a>00271         pndl = pndl-&gt;next;
<a name="l00272"></a>00272         <span class="keywordflow">continue</span>;
<a name="l00273"></a>00273       }
<a name="l00274"></a>00274       log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_DEBUG, <span class="stringliteral">&quot;Unable to open \&quot;%s\&quot;.&quot;</span>, ncs);
<a name="l00275"></a>00275       <span class="keywordflow">return</span> NULL;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277     <span class="keywordflow">for</span> (uint32_t i = 0; i &gt; context-&gt;user_defined_device_count; i++) {
<a name="l00278"></a>00278       <span class="keywordflow">if</span> (strcmp(ncs, context-&gt;user_defined_devices[i].connstring) == 0) {
<a name="l00279"></a>00279         <span class="comment">// This is a device sets by user, we use the device name given by user</span>
<a name="l00280"></a>00280         strcpy(pnd-&gt;<a class="code" href="structnfc__device.html#a4df256ca147bcf8b94c2d49bad2812b0">name</a>, context-&gt;user_defined_devices[i].name);
<a name="l00281"></a>00281         <span class="keywordflow">break</span>;
<a name="l00282"></a>00282       }
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284     log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_DEBUG, <span class="stringliteral">&quot;\&quot;%s\&quot; (%s) has been claimed.&quot;</span>, pnd-&gt;<a class="code" href="structnfc__device.html#a4df256ca147bcf8b94c2d49bad2812b0">name</a>, pnd-&gt;<a class="code" href="structnfc__device.html#a8ed0e09e7407ecb63aa8a4b3320f8bd7">connstring</a>);
<a name="l00285"></a>00285     <span class="keywordflow">return</span> pnd;
<a name="l00286"></a>00286   }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   <span class="comment">// Too bad, no driver can decode connstring</span>
<a name="l00289"></a>00289   log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_DEBUG, <span class="stringliteral">&quot;No driver available to handle \&quot;%s\&quot;.&quot;</span>, ncs);
<a name="l00290"></a>00290   <span class="keywordflow">return</span> NULL;
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00299"></a>00299 <span class="keywordtype">void</span>
<a name="l00300"></a><a class="code" href="group__dev.html#ga391821649d656a2431a6d174a3db8b30">00300</a> <a class="code" href="group__dev.html#ga391821649d656a2431a6d174a3db8b30" title="Close from a NFC device.">nfc_close</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302   <span class="keywordflow">if</span> (pnd) {
<a name="l00303"></a>00303     <span class="comment">// Close, clean up and release the device</span>
<a name="l00304"></a>00304     pnd-&gt;driver-&gt;close(pnd);
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00316"></a>00316 <span class="keywordtype">size_t</span>
<a name="l00317"></a><a class="code" href="group__dev.html#gafa660af0c0729cd5378fe895876b42c5">00317</a> <a class="code" href="group__dev.html#gafa660af0c0729cd5378fe895876b42c5" title="Scan for discoverable supported devices (ie. only available for some drivers)">nfc_list_devices</a>(<a class="code" href="structnfc__context.html" title="NFC library context Struct which contains internal options, references, pointers, etc...">nfc_context</a> *context, <a class="code" href="nfc-types_8h.html#a4661cdd5e004127850781d7d78c72cc7">nfc_connstring</a> connstrings[], <span class="keyword">const</span> <span class="keywordtype">size_t</span> connstrings_len)
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319   <span class="keywordtype">size_t</span> device_found = 0;
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 <span class="preprocessor">#ifdef CONFFILES</span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>  <span class="comment">// Load manually configured devices (from config file and env variables)</span>
<a name="l00323"></a>00323   <span class="comment">// TODO From env var...</span>
<a name="l00324"></a>00324   <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; context-&gt;user_defined_device_count; i++) {
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (context-&gt;user_defined_devices[i].optional) {
<a name="l00326"></a>00326       <span class="comment">// let&#39;s make sure the device exists</span>
<a name="l00327"></a>00327       <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd = NULL;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="preprocessor">#ifdef ENVVARS</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span>      <span class="keywordtype">char</span> *env_log_level = getenv(<span class="stringliteral">&quot;LIBNFC_LOG_LEVEL&quot;</span>);
<a name="l00331"></a>00331       <span class="keywordtype">char</span> *old_env_log_level = NULL;
<a name="l00332"></a>00332       <span class="comment">// do it silently</span>
<a name="l00333"></a>00333       <span class="keywordflow">if</span> (env_log_level) {
<a name="l00334"></a>00334         <span class="keywordflow">if</span> ((old_env_log_level = malloc(strlen(env_log_level) + 1)) == NULL) {
<a name="l00335"></a>00335           log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_ERROR, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Unable to malloc()&quot;</span>);
<a name="l00336"></a>00336           <span class="keywordflow">return</span> 0;
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338         strcpy(old_env_log_level, env_log_level);
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340       setenv(<span class="stringliteral">&quot;LIBNFC_LOG_LEVEL&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, 1);
<a name="l00341"></a>00341 <span class="preprocessor">#endif // ENVVARS</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>
<a name="l00343"></a>00343       pnd = <a class="code" href="group__dev.html#ga9a0b9811c0e7f93e7474db82a1fb4501" title="Open a NFC device.">nfc_open</a>(context, context-&gt;user_defined_devices[i].connstring);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="preprocessor">#ifdef ENVVARS</span>
<a name="l00346"></a>00346 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (old_env_log_level) {
<a name="l00347"></a>00347         setenv(<span class="stringliteral">&quot;LIBNFC_LOG_LEVEL&quot;</span>, old_env_log_level, 1);
<a name="l00348"></a>00348         free(old_env_log_level);
<a name="l00349"></a>00349       } <span class="keywordflow">else</span> {
<a name="l00350"></a>00350         unsetenv(<span class="stringliteral">&quot;LIBNFC_LOG_LEVEL&quot;</span>);
<a name="l00351"></a>00351       }
<a name="l00352"></a>00352 <span class="preprocessor">#endif // ENVVARS</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span>
<a name="l00354"></a>00354       <span class="keywordflow">if</span> (pnd) {
<a name="l00355"></a>00355         <a class="code" href="group__dev.html#ga391821649d656a2431a6d174a3db8b30" title="Close from a NFC device.">nfc_close</a>(pnd);
<a name="l00356"></a>00356         log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_DEBUG, <span class="stringliteral">&quot;User device %s found&quot;</span>, context-&gt;user_defined_devices[i].name);
<a name="l00357"></a>00357         strcpy((<span class="keywordtype">char</span> *)(connstrings + device_found), context-&gt;user_defined_devices[i].connstring);
<a name="l00358"></a>00358         device_found ++;
<a name="l00359"></a>00359         <span class="keywordflow">if</span> (device_found == connstrings_len)
<a name="l00360"></a>00360           <span class="keywordflow">break</span>;
<a name="l00361"></a>00361       }
<a name="l00362"></a>00362     } <span class="keywordflow">else</span> {
<a name="l00363"></a>00363       <span class="comment">// manual choice is not marked as optional so let&#39;s take it blindly</span>
<a name="l00364"></a>00364       strcpy((<span class="keywordtype">char</span> *)(connstrings + device_found), context-&gt;user_defined_devices[i].connstring);
<a name="l00365"></a>00365       device_found++;
<a name="l00366"></a>00366       <span class="keywordflow">if</span> (device_found &gt;= connstrings_len)
<a name="l00367"></a>00367         <span class="keywordflow">return</span> device_found;
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370 <span class="preprocessor">#endif // CONFFILES</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>
<a name="l00372"></a>00372   <span class="comment">// Device auto-detection</span>
<a name="l00373"></a>00373   <span class="keywordflow">if</span> (context-&gt;allow_autoscan) {
<a name="l00374"></a>00374     <span class="keyword">const</span> <span class="keyword">struct </span>nfc_driver_list *pndl = nfc_drivers;
<a name="l00375"></a>00375     <span class="keywordflow">while</span> (pndl) {
<a name="l00376"></a>00376       <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="nfc-types_8h.html#a248817f16c689686290df9c35fa3dd78">nfc_driver</a> *ndr = pndl-&gt;driver;
<a name="l00377"></a>00377       <span class="keywordflow">if</span> ((ndr-&gt;scan_type == NOT_INTRUSIVE) || ((context-&gt;allow_intrusive_scan) &amp;&amp; (ndr-&gt;scan_type == INTRUSIVE))) {
<a name="l00378"></a>00378         <span class="keywordtype">size_t</span> _device_found = ndr-&gt;scan(context, connstrings + (device_found), connstrings_len - (device_found));
<a name="l00379"></a>00379         log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_DEBUG, <span class="stringliteral">&quot;%ld device(s) found using %s driver&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) _device_found, ndr-&gt;name);
<a name="l00380"></a>00380         <span class="keywordflow">if</span> (_device_found &gt; 0) {
<a name="l00381"></a>00381           device_found += _device_found;
<a name="l00382"></a>00382           <span class="keywordflow">if</span> (device_found == connstrings_len)
<a name="l00383"></a>00383             <span class="keywordflow">break</span>;
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385       } <span class="comment">// scan_type is INTRUSIVE but not allowed or NOT_AVAILABLE</span>
<a name="l00386"></a>00386       pndl = pndl-&gt;next;
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context-&gt;user_defined_device_count == 0) {
<a name="l00389"></a>00389     log_put(LOG_GROUP, LOG_CATEGORY, NFC_LOG_PRIORITY_INFO, <span class="stringliteral">&quot;Warning: %s&quot;</span> , <span class="stringliteral">&quot;user must specify device(s) manually when autoscan is disabled&quot;</span>);
<a name="l00390"></a>00390   }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <span class="keywordflow">return</span> device_found;
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00406"></a>00406 <span class="keywordtype">int</span>
<a name="l00407"></a><a class="code" href="group__properties.html#ga2aa87b2080cc8ef5da8021b20b3e89d2">00407</a> <a class="code" href="group__properties.html#ga2aa87b2080cc8ef5da8021b20b3e89d2" title="Set a device&#39;s integer-property value.">nfc_device_set_property_int</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4">nfc_property</a> property, <span class="keyword">const</span> <span class="keywordtype">int</span> value)
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(device_set_property_int, pnd, property, value);
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00425"></a>00425 <span class="keywordtype">int</span>
<a name="l00426"></a><a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa">00426</a> <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4">nfc_property</a> property, <span class="keyword">const</span> <span class="keywordtype">bool</span> bEnable)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(device_set_property_bool, pnd, property, bEnable);
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00451"></a>00451 <span class="keywordtype">int</span>
<a name="l00452"></a><a class="code" href="group__initiator.html#ga4cab5665c89d5be858147b1548c7af3f">00452</a> <a class="code" href="group__initiator.html#ga4cab5665c89d5be858147b1548c7af3f" title="Initialize NFC device as initiator (reader)">nfc_initiator_init</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454   <span class="keywordtype">int</span> res = 0;
<a name="l00455"></a>00455   <span class="comment">// Drop the field for a while</span>
<a name="l00456"></a>00456   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a63b7d7e9a531fa1c5cbf339c692b2036">NP_ACTIVATE_FIELD</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00457"></a>00457     <span class="keywordflow">return</span> res;
<a name="l00458"></a>00458   <span class="comment">// Enable field so more power consuming cards can power themselves up</span>
<a name="l00459"></a>00459   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a63b7d7e9a531fa1c5cbf339c692b2036">NP_ACTIVATE_FIELD</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00460"></a>00460     <span class="keywordflow">return</span> res;
<a name="l00461"></a>00461   <span class="comment">// Let the device try forever to find a target/tag</span>
<a name="l00462"></a>00462   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a40c6c76cf8468a1e2f8e59fdc63a4446">NP_INFINITE_SELECT</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00463"></a>00463     <span class="keywordflow">return</span> res;
<a name="l00464"></a>00464   <span class="comment">// Activate auto ISO14443-4 switching by default</span>
<a name="l00465"></a>00465   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a71410b151e3dd915ac1850a7874201b7">NP_AUTO_ISO14443_4</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00466"></a>00466     <span class="keywordflow">return</span> res;
<a name="l00467"></a>00467   <span class="comment">// Force 14443-A mode</span>
<a name="l00468"></a>00468   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a533fe5effda5996a47b9e01dddc0f3ac">NP_FORCE_ISO14443_A</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00469"></a>00469     <span class="keywordflow">return</span> res;
<a name="l00470"></a>00470   <span class="comment">// Force speed at 106kbps</span>
<a name="l00471"></a>00471   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4aed868c69b8c8987a742fc5c07f4a92d8">NP_FORCE_SPEED_106</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00472"></a>00472     <span class="keywordflow">return</span> res;
<a name="l00473"></a>00473   <span class="comment">// Disallow invalid frame</span>
<a name="l00474"></a>00474   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a5ca01de81b62c89081c968693699fff8">NP_ACCEPT_INVALID_FRAMES</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00475"></a>00475     <span class="keywordflow">return</span> res;
<a name="l00476"></a>00476   <span class="comment">// Disallow multiple frames</span>
<a name="l00477"></a>00477   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4aa8cb3c477c5f2ec339b2d921223d3149">NP_ACCEPT_MULTIPLE_FRAMES</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00478"></a>00478     <span class="keywordflow">return</span> res;
<a name="l00479"></a>00479   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_init, pnd);
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00491"></a>00491 <span class="keywordtype">int</span>
<a name="l00492"></a><a class="code" href="group__initiator.html#ga68ff1cacb14696dfe16e892499b24bc3">00492</a> <a class="code" href="group__initiator.html#ga68ff1cacb14696dfe16e892499b24bc3" title="Initialize NFC device as initiator with its secure element initiator (reader)">nfc_initiator_init_secure_element</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l00493"></a>00493 {
<a name="l00494"></a>00494   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_init_secure_element, pnd);
<a name="l00495"></a>00495 }
<a name="l00496"></a>00496 
<a name="l00520"></a>00520 <span class="keywordtype">int</span>
<a name="l00521"></a><a class="code" href="group__initiator.html#gacbe0fa197206cac99c83ed0152174811">00521</a> <a class="code" href="group__initiator.html#gacbe0fa197206cac99c83ed0152174811" title="Select a passive or emulated tag.">nfc_initiator_select_passive_target</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00522"></a>00522                                     <span class="keyword">const</span> <a class="code" href="structnfc__modulation.html" title="NFC modulation structure.">nfc_modulation</a> nm,
<a name="l00523"></a>00523                                     <span class="keyword">const</span> uint8_t *pbtInitData, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szInitData,
<a name="l00524"></a>00524                                     <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt)
<a name="l00525"></a>00525 {
<a name="l00526"></a>00526   uint8_t *abtInit = NULL;
<a name="l00527"></a>00527   uint8_t abtTmpInit[MAX(12, szInitData)];
<a name="l00528"></a>00528   <span class="keywordtype">size_t</span>  szInit = 0;
<a name="l00529"></a>00529   <span class="keywordflow">if</span> (szInitData == 0) {
<a name="l00530"></a>00530     <span class="comment">// Provide default values, if any</span>
<a name="l00531"></a>00531     prepare_initiator_data(nm, &amp;abtInit, &amp;szInit);
<a name="l00532"></a>00532   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nm.nmt == NMT_ISO14443A) {
<a name="l00533"></a>00533     abtInit = abtTmpInit;
<a name="l00534"></a>00534     iso14443_cascade_uid(pbtInitData, szInitData, abtInit, &amp;szInit);
<a name="l00535"></a>00535   } <span class="keywordflow">else</span> {
<a name="l00536"></a>00536     abtInit = abtTmpInit;
<a name="l00537"></a>00537     memcpy(abtInit, pbtInitData, szInitData);
<a name="l00538"></a>00538     szInit = szInitData;
<a name="l00539"></a>00539   }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_select_passive_target, pnd, nm, abtInit, szInit, pnt);
<a name="l00542"></a>00542 }
<a name="l00543"></a>00543 
<a name="l00560"></a>00560 <span class="keywordtype">int</span>
<a name="l00561"></a><a class="code" href="group__initiator.html#gab0f9be52687bf9d62ba75abaf62a4c2c">00561</a> <a class="code" href="group__initiator.html#gab0f9be52687bf9d62ba75abaf62a4c2c" title="List passive or emulated tags.">nfc_initiator_list_passive_targets</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00562"></a>00562                                    <span class="keyword">const</span> <a class="code" href="structnfc__modulation.html" title="NFC modulation structure.">nfc_modulation</a> nm,
<a name="l00563"></a>00563                                    <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> ant[], <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTargets)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565   <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> nt;
<a name="l00566"></a>00566   <span class="keywordtype">size_t</span>  szTargetFound = 0;
<a name="l00567"></a>00567   uint8_t *pbtInitData = NULL;
<a name="l00568"></a>00568   <span class="keywordtype">size_t</span>  szInitDataLen = 0;
<a name="l00569"></a>00569   <span class="keywordtype">int</span> res = 0;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571   pnd-&gt;<a class="code" href="structnfc__device.html#a31c96b9d98b5be7eb19d7b7612dfcb44">last_error</a> = 0;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   <span class="comment">// Let the reader only try once to find a tag</span>
<a name="l00574"></a>00574   <span class="keywordtype">bool</span> bInfiniteSelect = pnd-&gt;<a class="code" href="structnfc__device.html#abeed7d9314e6e426e452412d32fdfb81">bInfiniteSelect</a>;
<a name="l00575"></a>00575   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a40c6c76cf8468a1e2f8e59fdc63a4446">NP_INFINITE_SELECT</a>, <span class="keyword">false</span>)) &lt; 0) {
<a name="l00576"></a>00576     <span class="keywordflow">return</span> res;
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   prepare_initiator_data(nm, &amp;pbtInitData, &amp;szInitDataLen);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   <span class="keywordflow">while</span> (<a class="code" href="group__initiator.html#gacbe0fa197206cac99c83ed0152174811" title="Select a passive or emulated tag.">nfc_initiator_select_passive_target</a>(pnd, nm, pbtInitData, szInitDataLen, &amp;nt) &gt; 0) {
<a name="l00582"></a>00582     <span class="keywordtype">size_t</span> i;
<a name="l00583"></a>00583     <span class="keywordtype">bool</span> seen = <span class="keyword">false</span>;
<a name="l00584"></a>00584     <span class="comment">// Check if we&#39;ve already seen this tag</span>
<a name="l00585"></a>00585     <span class="keywordflow">for</span> (i = 0; i &lt; szTargetFound; i++) {
<a name="l00586"></a>00586       <span class="keywordflow">if</span> (memcmp(&amp;(ant[i]), &amp;nt, <span class="keyword">sizeof</span>(<a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a>)) == 0) {
<a name="l00587"></a>00587         seen = <span class="keyword">true</span>;
<a name="l00588"></a>00588       }
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590     <span class="keywordflow">if</span> (seen) {
<a name="l00591"></a>00591       <span class="keywordflow">break</span>;
<a name="l00592"></a>00592     }
<a name="l00593"></a>00593     memcpy(&amp;(ant[szTargetFound]), &amp;nt, <span class="keyword">sizeof</span>(<a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a>));
<a name="l00594"></a>00594     szTargetFound++;
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (szTargets == szTargetFound) {
<a name="l00596"></a>00596       <span class="keywordflow">break</span>;
<a name="l00597"></a>00597     }
<a name="l00598"></a>00598     nfc_initiator_deselect_target(pnd);
<a name="l00599"></a>00599     <span class="comment">// deselect has no effect on FeliCa and Jewel cards so we&#39;ll stop after one...</span>
<a name="l00600"></a>00600     <span class="comment">// ISO/IEC 14443 B&#39; cards are polled at 100% probability so it&#39;s not possible to detect correctly two cards at the same time</span>
<a name="l00601"></a>00601     <span class="keywordflow">if</span> ((nm.nmt == NMT_FELICA) || (nm.nmt == NMT_JEWEL) || (nm.nmt == NMT_ISO14443BI) || (nm.nmt == NMT_ISO14443B2SR) || (nm.nmt == NMT_ISO14443B2CT)) {
<a name="l00602"></a>00602       <span class="keywordflow">break</span>;
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605   <span class="keywordflow">if</span> (bInfiniteSelect) {
<a name="l00606"></a>00606     <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a40c6c76cf8468a1e2f8e59fdc63a4446">NP_INFINITE_SELECT</a>, <span class="keyword">true</span>)) &lt; 0) {
<a name="l00607"></a>00607       <span class="keywordflow">return</span> res;
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609   }
<a name="l00610"></a>00610   <span class="keywordflow">return</span> szTargetFound;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00626"></a>00626 <span class="keywordtype">int</span>
<a name="l00627"></a><a class="code" href="group__initiator.html#gaed2949299759f9a889f6c93f5c365296">00627</a> <a class="code" href="group__initiator.html#gaed2949299759f9a889f6c93f5c365296" title="Polling for NFC targets.">nfc_initiator_poll_target</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00628"></a>00628                           <span class="keyword">const</span> <a class="code" href="structnfc__modulation.html" title="NFC modulation structure.">nfc_modulation</a> *pnmModulations, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szModulations,
<a name="l00629"></a>00629                           <span class="keyword">const</span> uint8_t uiPollNr, <span class="keyword">const</span> uint8_t uiPeriod,
<a name="l00630"></a>00630                           <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt)
<a name="l00631"></a>00631 {
<a name="l00632"></a>00632   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_poll_target, pnd, pnmModulations, szModulations, uiPollNr, uiPeriod, pnt);
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 
<a name="l00656"></a>00656 <span class="keywordtype">int</span>
<a name="l00657"></a><a class="code" href="group__initiator.html#gac47b117248c72b1e746ab9424e89c5b4">00657</a> <a class="code" href="group__initiator.html#gac47b117248c72b1e746ab9424e89c5b4" title="Select a target and request active or passive mode for D.E.P. (Data Exchange Protocol)">nfc_initiator_select_dep_target</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00658"></a>00658                                 <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a49938f9d4ecf6ba10554cbab30751b44" title="NFC D.E.P. (Data Exchange Protocol) active/passive mode.">nfc_dep_mode</a> ndm, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#aea4162a0fc281cafaf9905ae8efe8fe3" title="NFC baud rate enumeration.">nfc_baud_rate</a> nbr,
<a name="l00659"></a>00659                                 <span class="keyword">const</span> <a class="code" href="structnfc__dep__info.html" title="NFC target information in D.E.P. (Data Exchange Protocol) see ISO/IEC 18092 (NFCIP-1)">nfc_dep_info</a> *pndiInitiator, <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt, <span class="keyword">const</span> <span class="keywordtype">int</span> timeout)
<a name="l00660"></a>00660 {
<a name="l00661"></a>00661   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_select_dep_target, pnd, ndm, nbr, pndiInitiator, pnt, timeout);
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00681"></a>00681 <span class="keywordtype">int</span>
<a name="l00682"></a><a class="code" href="group__initiator.html#gaa5e08a085fc83e21714ffad598c1b89e">00682</a> <a class="code" href="group__initiator.html#gaa5e08a085fc83e21714ffad598c1b89e" title="Poll a target and request active or passive mode for D.E.P. (Data Exchange Protocol)">nfc_initiator_poll_dep_target</a>(<span class="keyword">struct</span> <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00683"></a>00683                               <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a49938f9d4ecf6ba10554cbab30751b44" title="NFC D.E.P. (Data Exchange Protocol) active/passive mode.">nfc_dep_mode</a> ndm, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#aea4162a0fc281cafaf9905ae8efe8fe3" title="NFC baud rate enumeration.">nfc_baud_rate</a> nbr,
<a name="l00684"></a>00684                               <span class="keyword">const</span> <a class="code" href="structnfc__dep__info.html" title="NFC target information in D.E.P. (Data Exchange Protocol) see ISO/IEC 18092 (NFCIP-1)">nfc_dep_info</a> *pndiInitiator,
<a name="l00685"></a>00685                               <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt,
<a name="l00686"></a>00686                               <span class="keyword">const</span> <span class="keywordtype">int</span> timeout)
<a name="l00687"></a>00687 {
<a name="l00688"></a>00688   <span class="keyword">const</span> <span class="keywordtype">int</span> period = 300;
<a name="l00689"></a>00689   <span class="keywordtype">int</span> remaining_time = timeout;
<a name="l00690"></a>00690   <span class="keywordtype">int</span> res;
<a name="l00691"></a>00691   <span class="keywordtype">int</span> result = 0;
<a name="l00692"></a>00692   <span class="keywordtype">bool</span> bInfiniteSelect = pnd-&gt;<a class="code" href="structnfc__device.html#abeed7d9314e6e426e452412d32fdfb81">bInfiniteSelect</a>;
<a name="l00693"></a>00693   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a40c6c76cf8468a1e2f8e59fdc63a4446">NP_INFINITE_SELECT</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00694"></a>00694     <span class="keywordflow">return</span> res;
<a name="l00695"></a>00695   <span class="keywordflow">while</span> (remaining_time &gt; 0) {
<a name="l00696"></a>00696     <span class="keywordflow">if</span> ((res = <a class="code" href="group__initiator.html#gac47b117248c72b1e746ab9424e89c5b4" title="Select a target and request active or passive mode for D.E.P. (Data Exchange Protocol)">nfc_initiator_select_dep_target</a>(pnd, ndm, nbr, pndiInitiator, pnt, period)) &lt; 0) {
<a name="l00697"></a>00697       <span class="keywordflow">if</span> (res != <a class="code" href="group__error.html#ga168bcb08598345280f29754aa2064fa9">NFC_ETIMEOUT</a>) {
<a name="l00698"></a>00698         result = res;
<a name="l00699"></a>00699         <span class="keywordflow">goto</span> end;
<a name="l00700"></a>00700       }
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     <span class="keywordflow">if</span> (res == 1) {
<a name="l00703"></a>00703       result = res;
<a name="l00704"></a>00704       <span class="keywordflow">goto</span> end;
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706     remaining_time -= period;
<a name="l00707"></a>00707   }
<a name="l00708"></a>00708 end:
<a name="l00709"></a>00709   <span class="keywordflow">if</span> (! bInfiniteSelect) {
<a name="l00710"></a>00710     <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a40c6c76cf8468a1e2f8e59fdc63a4446">NP_INFINITE_SELECT</a>, <span class="keyword">false</span>)) &lt; 0) {
<a name="l00711"></a>00711       <span class="keywordflow">return</span> res;
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713   }
<a name="l00714"></a>00714   <span class="keywordflow">return</span> result;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00729"></a>00729 <span class="keywordtype">int</span>
<a name="l00730"></a>00730 nfc_initiator_deselect_target(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l00731"></a>00731 {
<a name="l00732"></a>00732   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_deselect_target, pnd);
<a name="l00733"></a>00733 }
<a name="l00734"></a>00734 
<a name="l00763"></a>00763 <span class="keywordtype">int</span>
<a name="l00764"></a><a class="code" href="group__initiator.html#ga13ee4cff7a632065c0489d89e98ab41b">00764</a> <a class="code" href="group__initiator.html#ga13ee4cff7a632065c0489d89e98ab41b" title="Send data to target then retrieve data from target.">nfc_initiator_transceive_bytes</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> uint8_t *pbtTx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTx, uint8_t *pbtRx,
<a name="l00765"></a>00765                                <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx, <span class="keywordtype">int</span> timeout)
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_transceive_bytes, pnd, pbtTx, szTx, pbtRx, szRx, timeout)
<a name="l00768"></a>00768 }
<a name="l00769"></a>00769 
<a name="l00806"></a>00806 <span class="keywordtype">int</span>
<a name="l00807"></a><a class="code" href="group__initiator.html#ga16da6debcdd406542916fff1fafbff59">00807</a> <a class="code" href="group__initiator.html#ga16da6debcdd406542916fff1fafbff59" title="Transceive raw bit-frames to a target.">nfc_initiator_transceive_bits</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00808"></a>00808                               <span class="keyword">const</span> uint8_t *pbtTx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTxBits, <span class="keyword">const</span> uint8_t *pbtTxPar,
<a name="l00809"></a>00809                               uint8_t *pbtRx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx,
<a name="l00810"></a>00810                               uint8_t *pbtRxPar)
<a name="l00811"></a>00811 {
<a name="l00812"></a>00812   (void)szRx;
<a name="l00813"></a>00813   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_transceive_bits, pnd, pbtTx, szTxBits, pbtTxPar, pbtRx, pbtRxPar);
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00842"></a>00842 <span class="keywordtype">int</span>
<a name="l00843"></a><a class="code" href="group__initiator.html#gaa62d32c4463b83e76b33a6995332d20f">00843</a> <a class="code" href="group__initiator.html#gaa62d32c4463b83e76b33a6995332d20f" title="Send data to target then retrieve data from target.">nfc_initiator_transceive_bytes_timed</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00844"></a>00844                                      <span class="keyword">const</span> uint8_t *pbtTx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTx,
<a name="l00845"></a>00845                                      uint8_t *pbtRx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx,
<a name="l00846"></a>00846                                      uint32_t *cycles)
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_transceive_bytes_timed, pnd, pbtTx, szTx, pbtRx, szRx, cycles);
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00861"></a>00861 <span class="keywordtype">int</span>
<a name="l00862"></a><a class="code" href="group__initiator.html#gaaa5252f8eb1deaf688e6cd1fad9bdc45">00862</a> <a class="code" href="group__initiator.html#gaaa5252f8eb1deaf688e6cd1fad9bdc45" title="Check target presence.">nfc_initiator_target_is_present</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt)
<a name="l00863"></a>00863 {
<a name="l00864"></a>00864   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_target_is_present, pnd, pnt);
<a name="l00865"></a>00865 }
<a name="l00866"></a>00866 
<a name="l00888"></a>00888 <span class="keywordtype">int</span>
<a name="l00889"></a><a class="code" href="group__initiator.html#ga1b82168a15baa41b7050fb6200f01791">00889</a> <a class="code" href="group__initiator.html#ga1b82168a15baa41b7050fb6200f01791" title="Transceive raw bit-frames to a target.">nfc_initiator_transceive_bits_timed</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd,
<a name="l00890"></a>00890                                     <span class="keyword">const</span> uint8_t *pbtTx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTxBits, <span class="keyword">const</span> uint8_t *pbtTxPar,
<a name="l00891"></a>00891                                     uint8_t *pbtRx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx,
<a name="l00892"></a>00892                                     uint8_t *pbtRxPar,
<a name="l00893"></a>00893                                     uint32_t *cycles)
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895   (void)szRx;
<a name="l00896"></a>00896   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(initiator_transceive_bits_timed, pnd, pbtTx, szTxBits, pbtTxPar, pbtRx, pbtRxPar, cycles);
<a name="l00897"></a>00897 }
<a name="l00898"></a>00898 
<a name="l00932"></a>00932 <span class="keywordtype">int</span>
<a name="l00933"></a><a class="code" href="group__target.html#ga311e976b29daab6a1019041281abccab">00933</a> <a class="code" href="group__target.html#ga311e976b29daab6a1019041281abccab" title="Initialize NFC device as an emulated tag.">nfc_target_init</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt, uint8_t *pbtRx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx, <span class="keywordtype">int</span> timeout)
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935   <span class="keywordtype">int</span> res = 0;
<a name="l00936"></a>00936   <span class="comment">// Disallow invalid frame</span>
<a name="l00937"></a>00937   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a5ca01de81b62c89081c968693699fff8">NP_ACCEPT_INVALID_FRAMES</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00938"></a>00938     <span class="keywordflow">return</span> res;
<a name="l00939"></a>00939   <span class="comment">// Disallow multiple frames</span>
<a name="l00940"></a>00940   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4aa8cb3c477c5f2ec339b2d921223d3149">NP_ACCEPT_MULTIPLE_FRAMES</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00941"></a>00941     <span class="keywordflow">return</span> res;
<a name="l00942"></a>00942   <span class="comment">// Make sure we reset the CRC and parity to chip handling.</span>
<a name="l00943"></a>00943   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a524e1dc9fe7a7b67ab965052440a7f57">NP_HANDLE_CRC</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00944"></a>00944     <span class="keywordflow">return</span> res;
<a name="l00945"></a>00945   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4ae084471e9b3081086009cb582dbe53cf">NP_HANDLE_PARITY</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00946"></a>00946     <span class="keywordflow">return</span> res;
<a name="l00947"></a>00947   <span class="comment">// Activate auto ISO14443-4 switching by default</span>
<a name="l00948"></a>00948   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a71410b151e3dd915ac1850a7874201b7">NP_AUTO_ISO14443_4</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00949"></a>00949     <span class="keywordflow">return</span> res;
<a name="l00950"></a>00950   <span class="comment">// Activate &quot;easy framing&quot; feature by default</span>
<a name="l00951"></a>00951   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a87388b19886b345ea2e7be6f1282d85b">NP_EASY_FRAMING</a>, <span class="keyword">true</span>)) &lt; 0)
<a name="l00952"></a>00952     <span class="keywordflow">return</span> res;
<a name="l00953"></a>00953   <span class="comment">// Deactivate the CRYPTO1 cipher, it may could cause problems when still active</span>
<a name="l00954"></a>00954   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a98b8b4e1147baecf210024a9d038259e">NP_ACTIVATE_CRYPTO1</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00955"></a>00955     <span class="keywordflow">return</span> res;
<a name="l00956"></a>00956   <span class="comment">// Drop explicitely the field</span>
<a name="l00957"></a>00957   <span class="keywordflow">if</span> ((res = <a class="code" href="group__properties.html#ga65181f161e4abc3872425c4ad07343aa" title="Set a device&#39;s boolean-property value.">nfc_device_set_property_bool</a>(pnd, <a class="code" href="nfc-types_8h.html#a3321d98a990bdbc15fad9edc6d65faf4a63b7d7e9a531fa1c5cbf339c692b2036">NP_ACTIVATE_FIELD</a>, <span class="keyword">false</span>)) &lt; 0)
<a name="l00958"></a>00958     <span class="keywordflow">return</span> res;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(target_init, pnd, pnt, pbtRx, szRx, timeout);
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00973"></a>00973 <span class="keywordtype">int</span>
<a name="l00974"></a><a class="code" href="group__dev.html#ga4de5dfaa397d53a4048a43c7750f784e">00974</a> <a class="code" href="group__dev.html#ga4de5dfaa397d53a4048a43c7750f784e" title="Turn NFC device in idle mode.">nfc_idle</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(idle, pnd);
<a name="l00977"></a>00977 }
<a name="l00978"></a>00978 
<a name="l00990"></a>00990 <span class="keywordtype">int</span>
<a name="l00991"></a><a class="code" href="group__dev.html#gaa00bdccefbb41f66b86bc6b7e01c4153">00991</a> <a class="code" href="group__dev.html#gaa00bdccefbb41f66b86bc6b7e01c4153" title="Abort current running command.">nfc_abort_command</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l00992"></a>00992 {
<a name="l00993"></a>00993   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(abort_command, pnd);
<a name="l00994"></a>00994 }
<a name="l00995"></a>00995 
<a name="l01011"></a>01011 <span class="keywordtype">int</span>
<a name="l01012"></a><a class="code" href="group__target.html#ga03c7a1551c974a5f71e8d22102360035">01012</a> <a class="code" href="group__target.html#ga03c7a1551c974a5f71e8d22102360035" title="Send bytes and APDU frames.">nfc_target_send_bytes</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> uint8_t *pbtTx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTx, <span class="keywordtype">int</span> timeout)
<a name="l01013"></a>01013 {
<a name="l01014"></a>01014   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(target_send_bytes, pnd, pbtTx, szTx, timeout);
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 
<a name="l01031"></a>01031 <span class="keywordtype">int</span>
<a name="l01032"></a><a class="code" href="group__target.html#gab4efac914d5d1c932508c5928e0099d7">01032</a> <a class="code" href="group__target.html#gab4efac914d5d1c932508c5928e0099d7" title="Receive bytes and APDU frames.">nfc_target_receive_bytes</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, uint8_t *pbtRx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx, <span class="keywordtype">int</span> timeout)
<a name="l01033"></a>01033 {
<a name="l01034"></a>01034   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(target_receive_bytes, pnd, pbtRx, szRx, timeout);
<a name="l01035"></a>01035 }
<a name="l01036"></a>01036 
<a name="l01048"></a>01048 <span class="keywordtype">int</span>
<a name="l01049"></a><a class="code" href="group__target.html#ga09cd63cf3d0d8266a6afe84df23743e4">01049</a> <a class="code" href="group__target.html#ga09cd63cf3d0d8266a6afe84df23743e4" title="Send raw bit-frames.">nfc_target_send_bits</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> uint8_t *pbtTx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szTxBits, <span class="keyword">const</span> uint8_t *pbtTxPar)
<a name="l01050"></a>01050 {
<a name="l01051"></a>01051   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(target_send_bits, pnd, pbtTx, szTxBits, pbtTxPar);
<a name="l01052"></a>01052 }
<a name="l01053"></a>01053 
<a name="l01070"></a>01070 <span class="keywordtype">int</span>
<a name="l01071"></a><a class="code" href="group__target.html#gab7cf85ea4b7eae0ce6736cf6dcf25677">01071</a> <a class="code" href="group__target.html#gab7cf85ea4b7eae0ce6736cf6dcf25677" title="Receive bit-frames.">nfc_target_receive_bits</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, uint8_t *pbtRx, <span class="keyword">const</span> <span class="keywordtype">size_t</span> szRx, uint8_t *pbtRxPar)
<a name="l01072"></a>01072 {
<a name="l01073"></a>01073   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(target_receive_bits, pnd, pbtRx, szRx, pbtRxPar);
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 <span class="keyword">static</span> <span class="keyword">struct </span>sErrorMessage {
<a name="l01077"></a>01077   <span class="keywordtype">int</span>     iErrorCode;
<a name="l01078"></a>01078   <span class="keyword">const</span> <span class="keywordtype">char</span> *pcErrorMsg;
<a name="l01079"></a>01079 } sErrorMessages[] = {
<a name="l01080"></a>01080   <span class="comment">/* Chip-level errors (internal errors, RF errors, etc.) */</span>
<a name="l01081"></a>01081   { <a class="code" href="group__error.html#gaf4e6b9599444bd531ceb8cc0541b22a6">NFC_SUCCESS</a>, <span class="stringliteral">&quot;Success&quot;</span> },
<a name="l01082"></a>01082   { <a class="code" href="group__error.html#gaa80b1f4e792933ae0d20458773453eea">NFC_EIO</a>, <span class="stringliteral">&quot;Input / Output Error&quot;</span> },
<a name="l01083"></a>01083   { <a class="code" href="group__error.html#ga45996965dbf5bd4688cb026486b39bbe">NFC_EINVARG</a>, <span class="stringliteral">&quot;Invalid argument(s)&quot;</span> },
<a name="l01084"></a>01084   { <a class="code" href="group__error.html#gad1865aa3250cae3f3bf1d9741b842f70">NFC_EDEVNOTSUPP</a>, <span class="stringliteral">&quot;Not Supported by Device&quot;</span> },
<a name="l01085"></a>01085   { <a class="code" href="group__error.html#ga7e3be1e879982bbee69414ab9b85200d">NFC_ENOTSUCHDEV</a>, <span class="stringliteral">&quot;No Such Device&quot;</span> },
<a name="l01086"></a>01086   { <a class="code" href="group__error.html#ga3823aa83348d3391796dcb05c10b00db">NFC_EOVFLOW</a>, <span class="stringliteral">&quot;Buffer Overflow&quot;</span> },
<a name="l01087"></a>01087   { <a class="code" href="group__error.html#ga168bcb08598345280f29754aa2064fa9">NFC_ETIMEOUT</a>, <span class="stringliteral">&quot;Timeout&quot;</span> },
<a name="l01088"></a>01088   { <a class="code" href="group__error.html#gaaba44da321864b554932d1b11bf71af3">NFC_EOPABORTED</a>, <span class="stringliteral">&quot;Operation Aborted&quot;</span> },
<a name="l01089"></a>01089   { <a class="code" href="group__error.html#ga192c9a44e87913477f3d588822624a3b">NFC_ENOTIMPL</a>, <span class="stringliteral">&quot;Not (yet) Implemented&quot;</span> },
<a name="l01090"></a>01090   { <a class="code" href="group__error.html#ga60b73921d316ff6b98e39673a3dbfa6b">NFC_ETGRELEASED</a>, <span class="stringliteral">&quot;Target Released&quot;</span> },
<a name="l01091"></a>01091   { <a class="code" href="group__error.html#gaa143e8dd6c48a8f5fb52f396814da981">NFC_EMFCAUTHFAIL</a>, <span class="stringliteral">&quot;Mifare Authentication Failed&quot;</span> },
<a name="l01092"></a>01092   { <a class="code" href="group__error.html#ga9ec00389d3adbf496a2076e20633bbb6">NFC_ERFTRANS</a>, <span class="stringliteral">&quot;RF Transmission Error&quot;</span> },
<a name="l01093"></a>01093   { <a class="code" href="group__error.html#ga2a716485239faa0f9d384b87133a50f9">NFC_ECHIP</a>, <span class="stringliteral">&quot;Device&#39;s Internal Chip Error&quot;</span> },
<a name="l01094"></a>01094 };
<a name="l01095"></a>01095 
<a name="l01102"></a>01102 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01103"></a><a class="code" href="group__error.html#gab7864c2678696e920b966f47986d31d9">01103</a> <a class="code" href="group__error.html#gab7864c2678696e920b966f47986d31d9" title="Return the last error string.">nfc_strerror</a>(<span class="keyword">const</span> <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l01104"></a>01104 {
<a name="l01105"></a>01105   <span class="keyword">const</span> <span class="keywordtype">char</span> *pcRes = <span class="stringliteral">&quot;Unknown error&quot;</span>;
<a name="l01106"></a>01106   <span class="keywordtype">size_t</span>  i;
<a name="l01107"></a>01107   <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(sErrorMessages) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sErrorMessage)); i++) {
<a name="l01108"></a>01108     <span class="keywordflow">if</span> (sErrorMessages[i].iErrorCode == pnd-&gt;<a class="code" href="structnfc__device.html#a31c96b9d98b5be7eb19d7b7612dfcb44">last_error</a>) {
<a name="l01109"></a>01109       pcRes = sErrorMessages[i].pcErrorMsg;
<a name="l01110"></a>01110       <span class="keywordflow">break</span>;
<a name="l01111"></a>01111     }
<a name="l01112"></a>01112   }
<a name="l01113"></a>01113 
<a name="l01114"></a>01114   <span class="keywordflow">return</span> pcRes;
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 
<a name="l01125"></a>01125 <span class="keywordtype">int</span>
<a name="l01126"></a><a class="code" href="group__error.html#ga5d9665f8810f907aaa6caa5076b5c173">01126</a> <a class="code" href="group__error.html#ga5d9665f8810f907aaa6caa5076b5c173" title="Renders the last error in pcStrErrBuf for a maximum size of szBufLen chars.">nfc_strerror_r</a>(<span class="keyword">const</span> <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keywordtype">char</span> *pcStrErrBuf, <span class="keywordtype">size_t</span> szBufLen)
<a name="l01127"></a>01127 {
<a name="l01128"></a>01128   <span class="keywordflow">return</span> (snprintf(pcStrErrBuf, szBufLen, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="group__error.html#gab7864c2678696e920b966f47986d31d9" title="Return the last error string.">nfc_strerror</a>(pnd)) &lt; 0) ? -1 : 0;
<a name="l01129"></a>01129 }
<a name="l01130"></a>01130 
<a name="l01137"></a>01137 <span class="keywordtype">void</span>
<a name="l01138"></a><a class="code" href="group__error.html#ga00574f46e7c1bf30b18187329e417838">01138</a> <a class="code" href="group__error.html#ga00574f46e7c1bf30b18187329e417838" title="Display the last error occured on a nfc_device.">nfc_perror</a>(<span class="keyword">const</span> <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> <span class="keywordtype">char</span> *pcString)
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140   fprintf(stderr, <span class="stringliteral">&quot;%s: %s\n&quot;</span>, pcString, <a class="code" href="group__error.html#gab7864c2678696e920b966f47986d31d9" title="Return the last error string.">nfc_strerror</a>(pnd));
<a name="l01141"></a>01141 }
<a name="l01142"></a>01142 
<a name="l01149"></a>01149 <span class="keywordtype">int</span>
<a name="l01150"></a><a class="code" href="group__error.html#gacca948e9866dacdc680187343f460341">01150</a> <a class="code" href="group__error.html#gacca948e9866dacdc680187343f460341" title="Returns last error occured on a nfc_device.">nfc_device_get_last_error</a>(<span class="keyword">const</span> <a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l01151"></a>01151 {
<a name="l01152"></a>01152   <span class="keywordflow">return</span> pnd-&gt;<a class="code" href="structnfc__device.html#a31c96b9d98b5be7eb19d7b7612dfcb44">last_error</a>;
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155 <span class="comment">/* Special data accessors */</span>
<a name="l01156"></a>01156 
<a name="l01163"></a>01163 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01164"></a><a class="code" href="group__data.html#gaf670d5fd4a55110803002be8972c4a97">01164</a> <a class="code" href="group__data.html#gaf670d5fd4a55110803002be8972c4a97" title="Returns the device name.">nfc_device_get_name</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l01165"></a>01165 {
<a name="l01166"></a>01166   <span class="keywordflow">return</span> pnd-&gt;<a class="code" href="structnfc__device.html#a4df256ca147bcf8b94c2d49bad2812b0">name</a>;
<a name="l01167"></a>01167 }
<a name="l01168"></a>01168 
<a name="l01175"></a>01175 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01176"></a><a class="code" href="group__data.html#gaf5febf03977b8bee9ee663d9d630c730">01176</a> <a class="code" href="group__data.html#gaf5febf03977b8bee9ee663d9d630c730" title="Returns the device connection string.">nfc_device_get_connstring</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd)
<a name="l01177"></a>01177 {
<a name="l01178"></a>01178   <span class="keywordflow">return</span> pnd-&gt;<a class="code" href="structnfc__device.html#a8ed0e09e7407ecb63aa8a4b3320f8bd7">connstring</a>;
<a name="l01179"></a>01179 }
<a name="l01180"></a>01180 
<a name="l01189"></a>01189 <span class="keywordtype">int</span>
<a name="l01190"></a><a class="code" href="group__data.html#gae1bb0cc90d526eabbe8bea80df44cdab">01190</a> <a class="code" href="group__data.html#gae1bb0cc90d526eabbe8bea80df44cdab" title="Get supported modulations.">nfc_device_get_supported_modulation</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a1ef3c650c37195303a43a07bf4184a92" title="NFC mode type enumeration.">nfc_mode</a> mode, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a942af64a7fb7ccd6261454e7fb06ee3a" title="NFC modulation type enumeration.">nfc_modulation_type</a> **<span class="keyword">const</span> supported_mt)
<a name="l01191"></a>01191 {
<a name="l01192"></a>01192   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(get_supported_modulation, pnd, mode, supported_mt);
<a name="l01193"></a>01193 }
<a name="l01194"></a>01194 
<a name="l01203"></a>01203 <span class="keywordtype">int</span>
<a name="l01204"></a><a class="code" href="group__data.html#gae22fa9f0257a27f9f70b3f4aa6c4086f">01204</a> <a class="code" href="group__data.html#gae22fa9f0257a27f9f70b3f4aa6c4086f" title="Get supported baud rates.">nfc_device_get_supported_baud_rate</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a942af64a7fb7ccd6261454e7fb06ee3a" title="NFC modulation type enumeration.">nfc_modulation_type</a> nmt, <span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#aea4162a0fc281cafaf9905ae8efe8fe3" title="NFC baud rate enumeration.">nfc_baud_rate</a> **<span class="keyword">const</span> supported_br)
<a name="l01205"></a>01205 {
<a name="l01206"></a>01206   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(get_supported_baud_rate, pnd, nmt, supported_br);
<a name="l01207"></a>01207 }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209 <span class="comment">/* Misc. functions */</span>
<a name="l01210"></a>01210 
<a name="l01217"></a>01217 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01218"></a><a class="code" href="group__misc.html#gaa48f27c0f93d6508ad9a5ae01ab054d4">01218</a> <a class="code" href="group__misc.html#gaa48f27c0f93d6508ad9a5ae01ab054d4" title="Returns the library version.">nfc_version</a>(<span class="keywordtype">void</span>)
<a name="l01219"></a>01219 {
<a name="l01220"></a>01220 <span class="preprocessor">#ifdef GIT_REVISION</span>
<a name="l01221"></a>01221 <span class="preprocessor"></span>  <span class="keywordflow">return</span> GIT_REVISION;
<a name="l01222"></a>01222 <span class="preprocessor">#else</span>
<a name="l01223"></a>01223 <span class="preprocessor"></span>  <span class="keywordflow">return</span> PACKAGE_VERSION;
<a name="l01224"></a>01224 <span class="preprocessor">#endif // GIT_REVISION</span>
<a name="l01225"></a>01225 <span class="preprocessor"></span>}
<a name="l01226"></a>01226 
<a name="l01232"></a>01232 <span class="keywordtype">void</span>
<a name="l01233"></a><a class="code" href="group__misc.html#gab0fec1d37872367b47a4bd9513ab8991">01233</a> <a class="code" href="group__misc.html#gab0fec1d37872367b47a4bd9513ab8991" title="Free buffer allocated by libnfc.">nfc_free</a>(<span class="keywordtype">void</span> *p)
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235   free(p);
<a name="l01236"></a>01236 }
<a name="l01237"></a>01237 
<a name="l01246"></a>01246 <span class="keywordtype">int</span>
<a name="l01247"></a><a class="code" href="group__misc.html#gae97dd79f67cc6865c7f74bad17a37480">01247</a> <a class="code" href="group__misc.html#gae97dd79f67cc6865c7f74bad17a37480" title="Print information about NFC device.">nfc_device_get_information_about</a>(<a class="code" href="structnfc__device.html" title="NFC device information.">nfc_device</a> *pnd, <span class="keywordtype">char</span> **buf)
<a name="l01248"></a>01248 {
<a name="l01249"></a>01249   <a class="code" href="nfc-internal_8h.html#a76ca014e0817d22280b57e46d31a275f" title="Execute corresponding driver function if exists.">HAL</a>(device_get_information_about, pnd, buf);
<a name="l01250"></a>01250 }
<a name="l01251"></a>01251 
<a name="l01257"></a>01257 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01258"></a><a class="code" href="group__string-converter.html#ga3c105fdfaf8753b33246d131fbeb95db">01258</a> <a class="code" href="group__string-converter.html#ga3c105fdfaf8753b33246d131fbeb95db" title="Convert nfc_baud_rate value to string.">str_nfc_baud_rate</a>(<span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#aea4162a0fc281cafaf9905ae8efe8fe3" title="NFC baud rate enumeration.">nfc_baud_rate</a> nbr)
<a name="l01259"></a>01259 {
<a name="l01260"></a>01260   <span class="keywordflow">switch</span> (nbr) {
<a name="l01261"></a>01261     <span class="keywordflow">case</span> NBR_UNDEFINED:
<a name="l01262"></a>01262       <span class="keywordflow">return</span> <span class="stringliteral">&quot;undefined baud rate&quot;</span>;
<a name="l01263"></a>01263       <span class="keywordflow">break</span>;
<a name="l01264"></a>01264     <span class="keywordflow">case</span> NBR_106:
<a name="l01265"></a>01265       <span class="keywordflow">return</span> <span class="stringliteral">&quot;106 kbps&quot;</span>;
<a name="l01266"></a>01266       <span class="keywordflow">break</span>;
<a name="l01267"></a>01267     <span class="keywordflow">case</span> NBR_212:
<a name="l01268"></a>01268       <span class="keywordflow">return</span> <span class="stringliteral">&quot;212 kbps&quot;</span>;
<a name="l01269"></a>01269       <span class="keywordflow">break</span>;
<a name="l01270"></a>01270     <span class="keywordflow">case</span> NBR_424:
<a name="l01271"></a>01271       <span class="keywordflow">return</span> <span class="stringliteral">&quot;424 kbps&quot;</span>;
<a name="l01272"></a>01272       <span class="keywordflow">break</span>;
<a name="l01273"></a>01273     <span class="keywordflow">case</span> NBR_847:
<a name="l01274"></a>01274       <span class="keywordflow">return</span> <span class="stringliteral">&quot;847 kbps&quot;</span>;
<a name="l01275"></a>01275       <span class="keywordflow">break</span>;
<a name="l01276"></a>01276   }
<a name="l01277"></a>01277   <span class="comment">// Should never go there..</span>
<a name="l01278"></a>01278   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01279"></a>01279 }
<a name="l01280"></a>01280 
<a name="l01286"></a>01286 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01287"></a><a class="code" href="group__string-converter.html#gaa349f6eabeb7dbc5b03e92a9bcdc8733">01287</a> <a class="code" href="group__string-converter.html#gaa349f6eabeb7dbc5b03e92a9bcdc8733" title="Convert nfc_modulation_type value to string.">str_nfc_modulation_type</a>(<span class="keyword">const</span> <a class="code" href="nfc-types_8h.html#a942af64a7fb7ccd6261454e7fb06ee3a" title="NFC modulation type enumeration.">nfc_modulation_type</a> nmt)
<a name="l01288"></a>01288 {
<a name="l01289"></a>01289   <span class="keywordflow">switch</span> (nmt) {
<a name="l01290"></a>01290     <span class="keywordflow">case</span> NMT_ISO14443A:
<a name="l01291"></a>01291       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISO/IEC 14443A&quot;</span>;
<a name="l01292"></a>01292       <span class="keywordflow">break</span>;
<a name="l01293"></a>01293     <span class="keywordflow">case</span> NMT_ISO14443B:
<a name="l01294"></a>01294       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISO/IEC 14443-4B&quot;</span>;
<a name="l01295"></a>01295       <span class="keywordflow">break</span>;
<a name="l01296"></a>01296     <span class="keywordflow">case</span> NMT_ISO14443BI:
<a name="l01297"></a>01297       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISO/IEC 14443-4B&#39;&quot;</span>;
<a name="l01298"></a>01298       <span class="keywordflow">break</span>;
<a name="l01299"></a>01299     <span class="keywordflow">case</span> NMT_ISO14443B2CT:
<a name="l01300"></a>01300       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISO/IEC 14443-2B ASK CTx&quot;</span>;
<a name="l01301"></a>01301       <span class="keywordflow">break</span>;
<a name="l01302"></a>01302     <span class="keywordflow">case</span> NMT_ISO14443B2SR:
<a name="l01303"></a>01303       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISO/IEC 14443-2B ST SRx&quot;</span>;
<a name="l01304"></a>01304       <span class="keywordflow">break</span>;
<a name="l01305"></a>01305     <span class="keywordflow">case</span> NMT_FELICA:
<a name="l01306"></a>01306       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FeliCa&quot;</span>;
<a name="l01307"></a>01307       <span class="keywordflow">break</span>;
<a name="l01308"></a>01308     <span class="keywordflow">case</span> NMT_JEWEL:
<a name="l01309"></a>01309       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Innovision Jewel&quot;</span>;
<a name="l01310"></a>01310       <span class="keywordflow">break</span>;
<a name="l01311"></a>01311     <span class="keywordflow">case</span> NMT_DEP:
<a name="l01312"></a>01312       <span class="keywordflow">return</span> <span class="stringliteral">&quot;D.E.P.&quot;</span>;
<a name="l01313"></a>01313       <span class="keywordflow">break</span>;
<a name="l01314"></a>01314   }
<a name="l01315"></a>01315   <span class="comment">// Should never go there..</span>
<a name="l01316"></a>01316   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l01317"></a>01317 }
<a name="l01318"></a>01318 
<a name="l01327"></a>01327 <span class="keywordtype">int</span>
<a name="l01328"></a><a class="code" href="group__string-converter.html#ga112b3561115c13986b84efa541552fc6">01328</a> <a class="code" href="group__string-converter.html#ga112b3561115c13986b84efa541552fc6" title="Convert nfc_modulation_type value to string.">str_nfc_target</a>(<span class="keywordtype">char</span> **buf, <span class="keyword">const</span> <a class="code" href="structnfc__target.html" title="NFC target structure.">nfc_target</a> *pnt, <span class="keywordtype">bool</span> verbose)
<a name="l01329"></a>01329 {
<a name="l01330"></a>01330   *buf = malloc(4096);
<a name="l01331"></a>01331   <span class="keywordflow">if</span> (! *buf)
<a name="l01332"></a>01332     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ga7148e637813471ddd2156bae393ad5bd">NFC_ESOFT</a>;
<a name="l01333"></a>01333   (*buf)[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01334"></a>01334   snprint_nfc_target(*buf, 4096, pnt, verbose);
<a name="l01335"></a>01335   <span class="keywordflow">return</span> strlen(*buf);
<a name="l01336"></a>01336 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 24 2014 16:17:56 for libnfc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
